<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ai_teacher_system_back.mapper.LessonPlanMapper">
    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.example.ai_teacher_system_back.entity.LessonPlan">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="course_id" property="courseId" />
        <result column="chapter" property="chapter" />
        <result column="objectives" property="objectives" />
        <result column="content" property="content" />
        <result column="status" property="status" />
        <result column="plan_date" property="planDate" />
        <result column="creator_id" property="creatorId" />
        <result column="is_ai_generated" property="isAiGenerated" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>
    
    <!-- 插入备课计划 -->
    <insert id="insert" parameterType="com.example.ai_teacher_system_back.entity.LessonPlan" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO lesson_plan (
            name, course_id, chapter, objectives, content, status, 
            plan_date, creator_id, is_ai_generated, create_time, update_time
        ) VALUES (
            #{name}, #{courseId}, #{chapter}, #{objectives}, #{content}, #{status}, 
            #{planDate}, #{creatorId}, #{isAiGenerated}, #{createTime}, #{updateTime}
        )
    </insert>
    
    <!-- 更新备课计划 -->
    <update id="update" parameterType="com.example.ai_teacher_system_back.entity.LessonPlan">
        UPDATE lesson_plan
        SET name = #{name},
            chapter = #{chapter},
            objectives = #{objectives},
            content = #{content},
            status = #{status},
            plan_date = #{planDate},
            is_ai_generated = #{isAiGenerated},
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>
    
    <!-- 根据ID查询备课计划 -->
    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM lesson_plan WHERE id = #{id}
    </select>
    
    <!-- 根据课程ID查询备课计划列表 -->
    <select id="selectByCourseId" resultMap="BaseResultMap">
        SELECT * FROM lesson_plan WHERE course_id = #{courseId} ORDER BY create_time DESC
    </select>
    
    <!-- 根据创建者ID查询备课计划列表 -->
    <select id="selectByCreatorId" resultMap="BaseResultMap">
        SELECT * FROM lesson_plan WHERE creator_id = #{creatorId} ORDER BY create_time DESC
    </select>
    
    <!-- 删除备课计划 -->
    <delete id="deleteById">
        DELETE FROM lesson_plan WHERE id = #{id}
    </delete>
</mapper>